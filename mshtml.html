
<!DOCTYPE html>

<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<title>PicEncrypt</title>
</head>
<body oncontextmenu="return false" style="overflow-x:hidden">
  <!--Note that there's no Citrus at There!-->
  <style>
    input{
    background:#fff;
    border:3px solid #000; 
    height:1rem;
    border-radius:5px;
     box-shadow: 0 8px 16px 0 rgba(0,0,0,0.2), 0 6px 20px 0 rgba(0,0,0,0.19);
     outline:none;
    }
    button{
    background:rgb(255, 0, 0);
    border:3px solid rgb(255, 0, 0);
     box-shadow: 0 8px 16px 0 rgba(0,0,0,0.2), 0 6px 20px 0 rgba(0,0,0,0.19);
    
    border-radius:8px;
    height:2.5rem;
    width:10rem;
    font-size: 16px;
    -webkit-transition-duration: 0.4s; /* Safari */
        transition-duration: 0.4s;
        outline:none;
    }
    button:hover{
    background:rgb(85, 0, 0);
    border:3px solid rgb(85, 0, 0);
     box-shadow: 0 8px 16px 0 rgba(0,0,0,0.2), 0 6px 20px 0 rgba(0,0,0,0.19);
    
    border-radius:8px;
    height:2.5rem;
    width:10rem;
    font-size: 16px;
    outline:none;
    }
    select{
    background:#fc0;
    border:3px solid #fc0;
    border-radius:5px;
    height:2rem;
    width:10rem;
     box-shadow: 0 8px 16px 0 rgba(0,0,0,0.2), 0 6px 20px 0 rgba(0,0,0,0.19);
     outline:none;
    }
    </style>
<style>
    @media (prefers-color-scheme: dark) {
      :root {
        --bg: #262626;
        --textColor: #444;
        --borderColor: #2c2c3a;
        --primary: #24acf2;
      }
    }

    @media (prefers-color-scheme: light) {
      :root {
        --bg: #fff;
        --textColor: #aaa;
        --borderColor: #2c2c3a;
        --primary: #1bcfe7;
      }
    }

    :root[data-theme="light"] {
      --bg: #efefef;
      --textColor: #aaa;
      --borderColor: #2c2c3a;
      --primary: #1bcfe7;
    }

    :root[data-theme="dark"] {
      --bg: #262626;
      --textColor: #444;
      --borderColor: #2c2c3a;
      --primary: #24acf2;
    }

    * {
      margin: 0;
      padding: 0;
    }

    body {
      background-color: var(--bg);
      color: var(--textColor);
    }

    .flex {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
      width: 100vw;
    }
  </style>
  <script>
    function changeMode() {
      console.log("123");
      const darkMode =
        window.document.documentElement.getAttribute("data-theme") || "light";
      console.log(darkMode);
      if (darkMode == "light") {
        window.document.documentElement.setAttribute("data-theme", "dark");
      } else {
        window.document.documentElement.setAttribute("data-theme", "light");
      }
    }
  </script>

<div style="padding:0 16px;text-align:center">



   <?xml version="1.0" encoding="UTF-8" standalone="no"?>
   <!-- Created with Inkscape (http://www.inkscape.org/) -->
   
   <svg
      width="100%"
      height="8.5%"
      viewBox="0 0 264.58333 22.489583"
      version="1.1"
      id="svg5"
      inkscape:version="1.1 (c4e8f9e, 2021-05-24)"
      sodipodi:docname="head.svg"
      xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
      xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
      xmlns:xlink="http://www.w3.org/1999/xlink"
      xmlns="http://www.w3.org/2000/svg"
      xmlns:svg="http://www.w3.org/2000/svg">
     <sodipodi:namedview
        id="namedview7"
        pagecolor="#ffffff"
        bordercolor="#000000"
        borderopacity="0.25"
        inkscape:pageshadow="2"
        inkscape:pageopacity="0.0"
        inkscape:pagecheckerboard="0"
        inkscape:document-units="px"
        showgrid="true"
        units="px"
        width="1000px"
        inkscape:zoom="2"
        inkscape:cx="489.5"
        inkscape:cy="138.5"
        inkscape:window-width="2160"
        inkscape:window-height="1380"
        inkscape:window-x="0"
        inkscape:window-y="0"
        inkscape:window-maximized="1"
        inkscape:current-layer="layer1"
        inkscape:snap-page="true"
        inkscape:snap-text-baseline="true"
        inkscape:snap-center="true"
        inkscape:snap-object-midpoints="true"
        inkscape:snap-midpoints="true"
        inkscape:snap-smooth-nodes="true"
        inkscape:snap-intersection-paths="true"
        inkscape:object-paths="true"
        inkscape:snap-grids="true"
        height="200px">
       <inkscape:grid
          type="xygrid"
          id="grid1605" />
     </sodipodi:namedview>
     <defs
        id="defs2">
       <linearGradient
          inkscape:collect="always"
          id="linearGradient4847">
         <stop
            style="stop-color:#ffcc00;stop-opacity:1;"
            offset="0"
            id="stop4843" />
         <stop
            style="stop-color:#ffcc00;stop-opacity:0;"
            offset="1"
            id="stop4845" />
       </linearGradient>
       <linearGradient
          inkscape:collect="always"
          id="linearGradient4612">
         <stop
            style="stop-color:#ffaaaa;stop-opacity:1;"
            offset="0"
            id="stop4608" />
         <stop
            style="stop-color:#ffaaaa;stop-opacity:0;"
            offset="1"
            id="stop4610" />
       </linearGradient>
       <linearGradient
          inkscape:collect="always"
          id="linearGradient33031">
         <stop
            style="stop-color:#fff6d5;stop-opacity:1;"
            offset="0"
            id="stop33027" />
         <stop
            style="stop-color:#fff6d5;stop-opacity:0;"
            offset="1"
            id="stop33029" />
       </linearGradient>
       <rect
          x="340"
          y="0"
          width="560"
          height="230"
          id="rect24141" />
       <rect
          x="35"
          y="35"
          width="15"
          height="15"
          id="rect5421" />
       <rect
          x="68"
          y="65"
          width="81"
          height="54"
          id="rect76447" />
       <rect
          x="81"
          y="65"
          width="83"
          height="56"
          id="rect67531" />
       <rect
          x="71"
          y="77"
          width="77"
          height="26.000002"
          id="rect59825" />
       <rect
          x="89"
          y="72"
          width="65.447403"
          height="81.864227"
          id="rect42071" />
       <rect
          x="100"
          y="80"
          width="1000"
          height="280"
          id="rect29548" />
       <rect
          x="68"
          y="65"
          width="81"
          height="54"
          id="rect97624" />
       <rect
          x="68"
          y="65"
          width="81"
          height="54"
          id="rect112190" />
       <rect
          x="35"
          y="35"
          width="15"
          height="15"
          id="rect29867" />
       <linearGradient
          inkscape:collect="always"
          xlink:href="#linearGradient33031"
          id="linearGradient33033"
          x1="40.178005"
          y1="42.661999"
          x2="45.374008"
          y2="42.661999"
          gradientUnits="userSpaceOnUse" />
       <linearGradient
          inkscape:collect="always"
          xlink:href="#linearGradient4612"
          id="linearGradient4614"
          x1="5.2916665"
          y1="-84.666664"
          x2="264.58298"
          y2="11.244792"
          gradientUnits="userSpaceOnUse" />
       <linearGradient
          inkscape:collect="always"
          xlink:href="#linearGradient4847"
          id="linearGradient4849"
          x1="264.58334"
          y1="13.229166"
          x2="15.875"
          y2="74.083336"
          gradientUnits="userSpaceOnUse" />
     </defs>
     <g
        inkscape:label="图层 1"
        inkscape:groupmode="layer"
        id="layer1">
       <text
          xml:space="preserve"
          style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-size:1.74986px;font-family:'Arno Pro';-inkscape-font-specification:'Arno Pro';fill:#ffffff;stroke:none;stroke-width:0.145821"
          x="49.57922"
          y="9.8448877"
          id="text101100"
          transform="scale(1.8144362,0.55113539)"><tspan
            sodipodi:role="line"
            id="tspan101098"
            style="stroke-width:0.145821"
            x="49.57922"
            y="9.8448877"> </tspan></text>
       <rect
          style="fill:url(#linearGradient4614);fill-opacity:1;stroke:none;stroke-width:1.66969;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"
          id="rect2207"
          width="264.58298"
          height="22.489584"
          x="0"
          y="-3.8857806e-15" />
       <rect
          style="fill:url(#linearGradient4849);fill-opacity:1;stroke:none;stroke-width:1.66969;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"
          id="rect4823"
          width="264.58298"
          height="22.489584"
          x="0"
          y="-3.8857806e-15" />
       <text
          xml:space="preserve"
          transform="matrix(0.61132917,0,0,0.61132917,-247.05172,5.8565366)"
          id="text24139"
          style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-family:sans-serif;-inkscape-font-specification:sans-serif;text-align:center;white-space:pre;shape-inside:url(#rect24141);fill:#000000;stroke:none;stroke-width:11.3386"
          x="29.567934"
          y="0"><tspan
            x="582"
            y="12.06"
            id="tspan970">PicEncrypt</tspan></text>
     </g>
   </svg>
<br />
<a href="index.html" class="pathlink">PicEncrypt</a> <nobr style="color:#888;font-size:36px;">&nbsp;&gt;&nbsp;Picture Hider</nobr>
<style>
  .pathlink {color:#888;font-size:36px;text-decoration:none;}
</style>
      <br />
        <summary>Settings</summary>
        <div>
          <span>Select&ensp;</span>
          <input id="radio1" type="radio" name="OUT" value="" checked="true" /><spa>Default icon</span>
          <input id="radio2" type="radio" name="OUT" value="" /><span>Choose others...</span>
        </div>
        <div style="display:none">
          <span>Marker</span>&ensp;<input style="width:80px" id="ident" type="text" value="tpWj" />&ensp;<span>[Key object]</span>
        </div>
      <div>&emsp;</div>
      <button id="btn">Merge</button>
      <nobr style="font-size:34px;">|</nobr>
      <button id="btn1">Pack</button>
      <br />
      <button id="btn2">Extract</button>
      <nobr style="font-size:34px;">|</nobr>
      <button id="btn3">Save all</button>
    </div>
    <div id="info1" style="padding:0 1rem"></div>
    <div id="display" style="padding:1rem"></div>
    <script>
document.addEventListener('plusready', function() {
    let ctime=0
    let webview = plus.webview.currentWebview();
    plus.key.addEventListener('backbutton', function() {
        webview.canBack(function(e) {
          if(false&&e.canBack) {
            webview.back()
          }else{
            if(Date.now()-ctime>1000){
              ctime=Date.now()
              plus.nativeUI.toast("Swipe again")
            }else{
              plus.runtime.quit()
            }
          }
        })
    })
})
              document.addEventListener('plusready', function() {
                /*
                var Webview = plus.android.importClass("android.webkit.WebView");
                var WebSettings = plus.android.importClass("android.webkit.WebSettings");
                */
                var wv = plus.android.currentWebview();
                var setting = plus.android.invoke(wv, "getSettings");
                
                setting.setSupportZoom(true);
                setting.setBuiltInZoomControls(true)
                
                setting.setDisplayZoomControls(false)
                plus.webview.currentWebview().setStyle({
                    scalable: true
                });
            })
    </script>
    <script>
      
      (function() {
        let table = [0x00000000,0x77073096,0xEE0E612C,0x990951BA,0x076DC419,0x706AF48F,0xE963A535,0x9E6495A3,0x0EDB8832,0x79DCB8A4,0xE0D5E91E,0x97D2D988,0x09B64C2B,0x7EB17CBD,0xE7B82D07,0x90BF1D91,0x1DB71064,0x6AB020F2,0xF3B97148,0x84BE41DE,0x1ADAD47D,0x6DDDE4EB,0xF4D4B551,0x83D385C7,0x136C9856,0x646BA8C0,0xFD62F97A,0x8A65C9EC,0x14015C4F,0x63066CD9,0xFA0F3D63,0x8D080DF5,0x3B6E20C8,0x4C69105E,0xD56041E4,0xA2677172,0x3C03E4D1,0x4B04D447,0xD20D85FD,0xA50AB56B,0x35B5A8FA,0x42B2986C,0xDBBBC9D6,0xACBCF940,0x32D86CE3,0x45DF5C75,0xDCD60DCF,0xABD13D59,0x26D930AC,0x51DE003A,0xC8D75180,0xBFD06116,0x21B4F4B5,0x56B3C423,0xCFBA9599,0xB8BDA50F,0x2802B89E,0x5F058808,0xC60CD9B2,0xB10BE924,0x2F6F7C87,0x58684C11,0xC1611DAB,0xB6662D3D,0x76DC4190,0x01DB7106,0x98D220BC,0xEFD5102A,0x71B18589,0x06B6B51F,0x9FBFE4A5,0xE8B8D433,0x7807C9A2,0x0F00F934,0x9609A88E,0xE10E9818,0x7F6A0DBB,0x086D3D2D,0x91646C97,0xE6635C01,0x6B6B51F4,0x1C6C6162,0x856530D8,0xF262004E,0x6C0695ED,0x1B01A57B,0x8208F4C1,0xF50FC457,0x65B0D9C6,0x12B7E950,0x8BBEB8EA,0xFCB9887C,0x62DD1DDF,0x15DA2D49,0x8CD37CF3,0xFBD44C65,0x4DB26158,0x3AB551CE,0xA3BC0074,0xD4BB30E2,0x4ADFA541,0x3DD895D7,0xA4D1C46D,0xD3D6F4FB,0x4369E96A,0x346ED9FC,0xAD678846,0xDA60B8D0,0x44042D73,0x33031DE5,0xAA0A4C5F,0xDD0D7CC9,0x5005713C,0x270241AA,0xBE0B1010,0xC90C2086,0x5768B525,0x206F85B3,0xB966D409,0xCE61E49F,0x5EDEF90E,0x29D9C998,0xB0D09822,0xC7D7A8B4,0x59B33D17,0x2EB40D81,0xB7BD5C3B,0xC0BA6CAD,0xEDB88320,0x9ABFB3B6,0x03B6E20C,0x74B1D29A,0xEAD54739,0x9DD277AF,0x04DB2615,0x73DC1683,0xE3630B12,0x94643B84,0x0D6D6A3E,0x7A6A5AA8,0xE40ECF0B,0x9309FF9D,0x0A00AE27,0x7D079EB1,0xF00F9344,0x8708A3D2,0x1E01F268,0x6906C2FE,0xF762575D,0x806567CB,0x196C3671,0x6E6B06E7,0xFED41B76,0x89D32BE0,0x10DA7A5A,0x67DD4ACC,0xF9B9DF6F,0x8EBEEFF9,0x17B7BE43,0x60B08ED5,0xD6D6A3E8,0xA1D1937E,0x38D8C2C4,0x4FDFF252,0xD1BB67F1,0xA6BC5767,0x3FB506DD,0x48B2364B,0xD80D2BDA,0xAF0A1B4C,0x36034AF6,0x41047A60,0xDF60EFC3,0xA867DF55,0x316E8EEF,0x4669BE79,0xCB61B38C,0xBC66831A,0x256FD2A0,0x5268E236,0xCC0C7795,0xBB0B4703,0x220216B9,0x5505262F,0xC5BA3BBE,0xB2BD0B28,0x2BB45A92,0x5CB36A04,0xC2D7FFA7,0xB5D0CF31,0x2CD99E8B,0x5BDEAE1D,0x9B64C2B0,0xEC63F226,0x756AA39C,0x026D930A,0x9C0906A9,0xEB0E363F,0x72076785,0x05005713,0x95BF4A82,0xE2B87A14,0x7BB12BAE,0x0CB61B38,0x92D28E9B,0xE5D5BE0D,0x7CDCEFB7,0x0BDBDF21,0x86D3D2D4,0xF1D4E242,0x68DDB3F8,0x1FDA836E,0x81BE16CD,0xF6B9265B,0x6FB077E1,0x18B74777,0x88085AE6,0xFF0F6A70,0x66063BCA,0x11010B5C,0x8F659EFF,0xF862AE69,0x616BFFD3,0x166CCF45,0xA00AE278,0xD70DD2EE,0x4E048354,0x3903B3C2,0xA7672661,0xD06016F7,0x4969474D,0x3E6E77DB,0xAED16A4A,0xD9D65ADC,0x40DF0B66,0x37D83BF0,0xA9BCAE53,0xDEBB9EC5,0x47B2CF7F,0x30B5FFE9,0xBDBDF21C,0xCABAC28A,0x53B39330,0x24B4A3A6,0xBAD03605,0xCDD70693,0x54DE5729,0x23D967BF,0xB3667A2E,0xC4614AB8,0x5D681B02,0x2A6F2B94,0xB40BBE37,0xC30C8EA1,0x5A05DF1B,0x2D02EF8D];
        let crc32 = window.crc32 = (arr,crc)=>{
          crc = crc || 0;
          let n = 0;
          let x = 0;
          crc ^= -1;
          for(let i = 0 ; i < arr.length; i++ ) {
            n = ( crc ^ arr[i] ) & 0xFF;
            x = table[n];
            crc = ( crc >>> 8 ) ^ x;
          }
          crc ^= -1;
          return crc
        };
        return crc32
      })()
      function crc32arr(arr){
        return arr.reduce((a,b)=>crc32(b,a),0)
      }
      function stringtoarray(str,ifzero){
        let arr=new Uint8Array(str.length+(ifzero?1:0))
        for(let i=0;i<str.length;i++){
          arr[i]=str.charCodeAt(i)
        }
        return arr
      }
      function arraytostring(arr){
        return Array.from(arr).map(x=>String.fromCharCode(x)).join("")
      }
      function concatuint8array(arrays){
        let length=arrays.reduce((a,b)=>a+b.length,0)
        let result=new Uint8Array(length)
        let start=0
        arrays.map(x=>{
          result.set(x,start)
          start+=x.length
        })
        return result
      }
      function utf8Encode(string){
        var utftext = "";
        for (var n = 0; n < string.length; n++) {
          var c = string.charCodeAt(n);
          if (c < 128) {
            utftext += String.fromCharCode(c);
          } else if ((c > 127) && (c < 2048)) {
            utftext += String.fromCharCode((c >> 6) | 192);
            utftext += String.fromCharCode((c & 63) | 128);
          } else {
            utftext += String.fromCharCode((c >> 12) | 224);
            utftext += String.fromCharCode(((c >> 6) & 63) | 128);
            utftext += String.fromCharCode((c & 63) | 128);
          }
        }
        return utftext;
      }
      function utf8Decode(inputStr){
        var outputStr = "";
        var code1, code2, code3, code4;
        for (var i = 0; i < inputStr.length; i++) {
          code1 = inputStr.charCodeAt(i);
          if (code1 < 128) {
            outputStr += String.fromCharCode(code1);
          } else if (code1 < 224) {
            code2 = inputStr.charCodeAt(++i);
            outputStr += String.fromCharCode(((code1 & 31) << 6) | (code2 & 63));
          } else if (code1 < 240) {
            code2 = inputStr.charCodeAt(++i);
            code3 = inputStr.charCodeAt(++i);
            outputStr += String.fromCharCode(((code1 & 15) << 12) | ((code2 & 63) << 6) | (code3 & 63));
          } else {
            code2 = inputStr.charCodeAt(++i);
            code3 = inputStr.charCodeAt(++i);
            code4 = inputStr.charCodeAt(++i);
            outputStr += String.fromCharCode(((code1 & 7) << 18) | ((code2 & 63) << 12) | ((code3 & 63) << 6) | (code2 & 63));
          }
        }
        return outputStr;
      }
      function dataURLtoArray(dataurl){
        let arr  = dataurl.split(','),
           _arr  = arr[1],
           bstr  = atob(_arr),
           n     = bstr.length,
           u8arr = new Uint8Array(n)
        while (n--) {
          u8arr[n] = bstr.charCodeAt(n)
        }
        return u8arr
      }
      function getint32(arr,start){//from Uint8Array
        start=start||0
        return (arr[start]<<24)|(arr[start+1]<<16)|(arr[start+2]<<8)|arr[start+3]
      }
      function createint32(num){
        return[num>>>24,num>>>16&0xff,num>>>8&0xff,num&0xff]
      }
      function setint32(arr,num,start){
        start=start||0
        arr[start]=num>>>24
        arr[start+1]=num>>>16&0xff
        arr[start+2]=num>>>8&0xff
        arr[start+3]=num&0xff
      }
    </script>
    <script>
      let code=getint32(stringtoarray("tpWj"))
      
      let codeinput=document.getElementById("ident")
      codeinput.onchange=()=>{
        code=getint32(stringtoarray(code.value))
      }
      function extract(arr,code){
        //png文件magic number
        //89504e470d0a1a0a
        if(getint32(arr,0)!=(0x89504e47|0)){
          return false
        }
        code=code|0
        let i=8
        let result=[]
        while(i<arr.length-12){
          let length=getint32(arr,i)
          //一般情况下length不小于0
          if(getint32(arr,i+4)==code){
            result.push(arr.slice(i+8,i+8+length))
          }
          i+=length+12
        }
        return result
      }
      function unwraptofile(arr){
        let i=0
        while(arr[i]!=0){
          i++
        }
        let meta=JSON.parse(arraytostring(arr.slice(0,i)))
        return new File([arr.slice(i+1).buffer],utf8Decode(meta.name),{type:meta.mime})
      }
      function decode(file,code,returnfunc){
        let reader=new FileReader()
        reader.readAsArrayBuffer(file)
        reader.onload=e=>{
          let extracted=extract(new Uint8Array(e.target.result),code)
          if(!(extracted&&extracted.length>0)){
            returnfunc(false)
            return
          }
          let result=[]
          extracted.map(x=>{
            try{
              result.push(unwraptofile(x))
            }catch(e){}
          })
          if(result.length>0){
            returnfunc(result)
          }else{
            returnfunc(false)
          }
        }
      }
      
      function wrap(file,code,returnfunc){
        let reader=new FileReader(file)
        reader.readAsArrayBuffer(file)
        reader.onload=e=>{
          let arr=new Uint8Array(e.target.result)
          let meta=stringtoarray(JSON.stringify({
            name:utf8Encode(file.name),
            mime:file.type
          }),true)
          let ident=createint32(code)
          let lengtharr=createint32(meta.length+arr.length)
          let crcarr=createint32(crc32arr([ident,meta,arr]))
          let result=concatuint8array([lengtharr,ident,meta,arr,crcarr])
          returnfunc(result)
        }
      }
      function assembletoblob(pngarr,filearr){
        let l=pngarr.length
        let arr=concatuint8array([pngarr.slice(0,l-12)].concat(filearr).concat([pngarr.slice(l-12)]))
        return new Blob([arr.buffer],{type:"image/png"})
      }
      function randompngarr2(){
        let cvs=document.createElement("canvas")
        let ctx=cvs.getContext("2d")
        cvs.width=cvs.height=400
        ctx.fillStyle="#ffffff"
        ctx.fillRect(0,0,400,400)
        ctx.setTransform(1,0,0,1,50,50)
        
        let theta=Math.random()*2*Math.PI
        ctx.fillStyle="rgb("+[Math.cos(theta),Math.cos(theta-Math.PI*2/3),Math.cos(theta+Math.PI*2/3)].map(x=>x*(Math.random()+1)*64+96+Math.random()*64)+")"
        
        ctx.shadowColor="#bfbfbf"
        ctx.shadowOffsetX=10
        ctx.shadowOffsetY=10
        ctx.shadowBlur=15
        
        ctx.beginPath()
        ctx.arc(150,150,175,0,Math.PI*2)
        ctx.closePath()
        ctx.fill()
        
        ctx.shadowColor="rgba(0,0,0,0)"
        ctx.fillStyle=ctx.strokeStyle="#fff"
        
        ctx.lineJoin="round"
        ctx.lineWidth=16
        ctx.beginPath()
        ctx.moveTo(110,50)
        ctx.lineTo(225,50)
        ctx.lineTo(225,250)
        ctx.lineTo(75,250)
        ctx.lineTo(75,85)
        ctx.closePath()
        ctx.stroke()
        ctx.fillRect(105,110,90,16)
        ctx.fillRect(105,155,90,16)
        ctx.fillRect(105,200,90,16)
        return dataURLtoArray(cvs.toDataURL("image/png"))
      }
      function randompngarr(){
        let cvs=document.createElement("canvas")
        cvs.width=cvs.height=300
        let ctx=cvs.getContext("2d")
        let theta=Math.random()*2*Math.PI
        ctx.fillStyle="rgb("+[Math.cos(theta),Math.cos(theta-Math.PI*2/3),Math.cos(theta+Math.PI*2/3)].map(x=>x*(Math.random()+1)*64+96+Math.random()*64)+")"
        ctx.fillRect(0,0,300,300)
        ctx.fillStyle=ctx.strokeStyle="#fff"
        ctx.lineJoin="round"
        ctx.lineWidth=16
        ctx.beginPath()
        ctx.moveTo(110,50)
        ctx.lineTo(225,50)
        ctx.lineTo(225,250)
        ctx.lineTo(75,250)
        ctx.lineTo(75,85)
        ctx.closePath()
        ctx.stroke()
        ctx.fillRect(105,110,90,16)
        ctx.fillRect(105,155,90,16)
        ctx.fillRect(105,200,90,16)
        return dataURLtoArray(cvs.toDataURL("image/png"))
      }
      
    </script>
    <script>
//native.js
function stepsavefile(blob,dirPath,fileName,update){
  fileName=fileName||blob.name||"save"
  return new Promise(function(resolve,reject){
    let length=Math.ceil(blob.size/3000000)
    let result=[]
    let i=0
    function step(){
      let nblob=blob.slice(i*3000000,(i+1)*3000000)
      let fr=new FileReader()
      fr.readAsDataURL(nblob)
      fr.onload=e=>{
        let base64=e.target.result
        base64=base64.slice(base64.slice(0,100).indexOf("base64,")+7)
        writebase64(base64,dirPath,fileName,i*3000000).then(()=>{
          if(++i==length){
            resolve()
          }else{
            update(i/length)
            step()
          }
        },reject)
      }
    }
    step()
  })
}
function savefile(blob,dirPath,fileName){
  fileName=fileName||blob.name||"save"
  return new Promise(function(resolve,reject){
    let length=Math.ceil(blob.size/3000000)
    let j=length
    let result=[]
    for(let i=0;i<length;i++){
      let nblob=blob.slice(i*3000000,(i+1)*3000000)
      
      let fr=new FileReader()
      fr.readAsDataURL(nblob)
      fr.onload=e=>{
        let base64=e.target.result
        base64=base64.slice(base64.slice(0,100).indexOf("base64,")+7)
        result[i]=base64
        if(--j==0){
          result=result.join("")
          writebase64(result,dirPath,fileName,0).then(resolve,reject)
        }
      }
    }
  })
}
function writebase64(base64,dirPath,fileName,start) {
  return new Promise(function(resolve, reject) {
    plus.io.resolveLocalFileSystemURL("storage/emulated/0", function(entry) {
      entry.getDirectory(dirPath, {
        create: true,
        exclusive: false,
      }, function(entry) {
        entry.getFile(fileName, {
          create: true,
          exclusive: false,
        }, function(entry) {
          entry.createWriter(function(writer) {
            writer.onwrite=()=>{
              resolve()
            }
            writer.onerror = reject
            writer.seek(start)
            writer.writeAsBinary(base64)
          }, reject)
        }, reject)
      }, reject)
    }, reject)
  })
}
function broadcast(dirPath){
    dirPath=dirPath||"save"
    var main = plus.android.runtimeMainActivity()
    var Intent = plus.android.importClass("android.content.Intent");
    var Uri=plus.android.importClass("android.net.Uri")
    main.sendBroadcast(new Intent(Intent.ACTION_MEDIA_SCANNER_SCAN_FILE,
    Uri.parse("file:///storage/emulated/0/"+dirPath+"/")))
}
    </script>
    <script>
      //download
let dlmanager={}
function dlclear(){
  dlmanager.dlist=[]
  dlmanager.dlist.remain=0
  let div=document.createElement("div")
  div.style.color="#666"
  dlmanager.dlist.div=div
}
dlclear()
function dlall(){
  dlmanager.dlist.map(x=>{
    x.dl()
  })
  return dlmanager.dlist.div
}
function createhref(blob){
  let name=randomname()+"-"+(blob.name?blob.name:"tpwjj.png")
  let span=document.createElement("span")
  span.innerText="保存"
  span.style.color="#1080a0"
  span.dlstatus=0
  span.dlname=name
  span.dlblob=blob
  
  dlmanager.dlist.push(span)
  dlmanager.dlist.remain++
  dlupdate()
  
  span.onclick=span.dl=()=>{
    if(span.dlstatus==0){
      
      span.dlstatus=1
      span.style.color="#666"
      span.innerText="保存中:0%"
      
      stepsavefile(blob,"Download/tpwjj",name,(p)=>{
        if(dlmanager.dlist.remain==1){
          dlupdatep(p)
        }
        span.innerText="保存中:"+Math.floor(p*100)+"%"
      }).then(()=>{
        //resolve
        span.dlstatus=2
        span.innerText="保存成功"
        broadcast("Download/tpwjj")
        dlmanager.dlist.remain--
        dlupdate()
      },()=>{
        //reject
        span.dlstatus=0
        span.innerText="保存失败"
      })
      
    }
  }
  
  return span
}
function dlupdate(){
  dlmanager.dlist.div.innerText="剩余:"+dlmanager.dlist.remain
  if(dlmanager.dlist.remain==0){
    dlmanager.dlist.div.innerHTML="保存成功"
  }
}
function dlupdatep(p){
  dlmanager.dlist.div.innerText="剩余:"+dlmanager.dlist.remain+","+Math.floor(p*100)+"%"
}
function randomname(){
  return Date.now().toString(36).slice(-8)+Math.random().toString(36).slice(2,7)
}

    </script>
    <script>
      let def=true
      let parr
      let radio1=document.getElementById("radio1")
      let radio2=document.getElementById("radio2")
      radio2.onclick=()=>{
        let ipt=document.createElement("input")
        ipt.type="file"
        ipt.accept="image/*"
        ipt.onchange=()=>{
          let src=URL.createObjectURL(ipt.files[0])
          let img=new Image()
          img.src=src
          img.onload=()=>{
            URL.revokeObjectURL(src)
            let cvs=document.createElement("canvas")
            let ctx=cvs.getContext("2d")
            let w=img.width
            let h=img.height
            if(w*h>100000){
              let scale=Math.sqrt(w*h/100000)
              w=Math.round(w/scale)
              h=Math.round(h/scale)
            }
            cvs.width=w
            cvs.height=h
            ctx.drawImage(img,0,0,w,h)
            parr=dataURLtoArray(cvs.toDataURL())
            def=false
          }
        }
        ipt.click()
      }
      radio1.onclick=()=>{
        def=true
      }
      function genpngarr(big){
        if(def){
          if(big){
            return randompngarr2()
          }else{
            return randompngarr()
          }
        }else{
          return parr
        }
      }
    </script>
    <script>
      let srclist=[]
      let display=document.getElementById("display")
      let info1=document.getElementById("info1")
      function clear(){
        display.innerHTML=""
        info1.innerHTML=""
        srclist.map(x=>URL.revokeObjectURL(x))
        srclist=[]
        dlclear()
      }
      function createdisplay(b){
        let src=URL.createObjectURL(b)
        srclist.push(b)
        
        let div=document.createElement("div")
        div.style.paddingTop="0.5rem"
        
        let div2=document.createElement("div")
        div2.style.wordBreak="break-all"
        div.appendChild(div2)
        
        /*
        let a=document.createElement("a")
        a.innerText="保存"
        a.href=src
        a.download=b.name
        */
        div2.appendChild(createhref(b))
        
        let span=document.createElement("span")
        span.innerText=b.name
        span.innerHTML="&emsp;"+span.innerHTML
        div2.appendChild(span)
        
        if(b.type.indexOf("image")>-1){
          let img=document.createElement("img")
          img.style.maxWidth="100%"
          img.src=src
          div.appendChild(img)
        }
        
        if(b.type.indexOf("video")>-1){
          let img=document.createElement("video")
          img.controls=true
          img.style.maxWidth="100%"
          img.src=src
          div.appendChild(img)
        }
        
        return div
      }
      let btn=document.getElementById("btn")
      btn.onclick=()=>{
        clear()
        let ipt=document.createElement("input")
        ipt.type="file"
        ipt.multiple=true
        ipt.onchange=()=>{
          let j=ipt.files.length
          let finish=[]
          Array.from(ipt.files).map((f,x)=>{
            wrap(f,code,r=>{
              finish[x]=r
              if(--j==0){
                let blob=assembletoblob(genpngarr(true),finish)
                createhref(blob)
                let src=URL.createObjectURL(blob)
                srclist.push(src)
                let img=document.createElement("img")
                img.src=src
                img.style.maxWidth="100%"
                display.appendChild(img)
              }
            })
          })
        }
        ipt.click()
      }
      let btn1=document.getElementById("btn1")
      btn1.onclick=()=>{
        clear()
        let ipt=document.createElement("input")
        ipt.type="file"
        ipt.multiple=true
        ipt.onchange=()=>{
          Array.from(ipt.files).map(f=>{
            wrap(f,code,r=>{
              let blob=assembletoblob(genpngarr(false),[r])
              createhref(blob)
              let src=URL.createObjectURL(blob)
              srclist.push(src)
              let img=document.createElement("img")
              img.src=src
              img.style.width="100px"
              img.style.margin="4px"
              display.appendChild(img)
            })
          })
        }
        ipt.click()
      }
      let btn2=document.getElementById("btn2")
      btn2.onclick=()=>{
        clear()
        let ipt=document.createElement("input")
        ipt.type="file"
        ipt.accept="image/*"
        ipt.multiple=true
        ipt.onchange=()=>{
          Array.from(ipt.files).map(f=>{
            decode(f,code,r=>{
              if(r){
                r.map(x=>{
                  display.appendChild(createdisplay(x))
                })
              }
            })
          })
        }
        ipt.click()
      }
    </script>
    <script>
      let btn3=document.getElementById("btn3")
      btn3.onclick=()=>{
        info1.innerHTML=""
        info1.appendChild(dlall())
      }
    </script>
  </body>
</html>
